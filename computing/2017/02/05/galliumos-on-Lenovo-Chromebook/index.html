<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script type="text/javascript">
    var host = "johndmart.in";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script>

  <title>GalliumOS on Chromebook&nbsp;|&nbsp;John D. Martin III</title>
  <meta name="description" content="I have had a Chromebook for a few years  and have always wanted to put a real Linux distribution on it. This weekend my friend Elliott Hauser showed me GalliumOS, which is being developed as a full but lightweight GNU/Linux distribution for Chromebooks. ">
  <meta name="keywords" content="CHRX, GalliumOS, ChromeOS, Chromebook, Lenovo N20P, atmel_mxt_ts, touchscreen, Ubuntu, Linux">
  <meta name="author" content="John D. Martin III">

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  
  
  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

  <link rel="stylesheet" href="/css/tufte.css?v=1.0"> 
  
  <link rel="icon" href="/assets/img/favicon.ico?v=1.0" type="image/x-icon" />

  <link rel="canonical" href="https://johndmart.in/computing/2017/02/05/galliumos-on-Lenovo-Chromebook/">

  <link rel="alternate" type="application/rss+xml" title="John D. Martin III" href="https://johndmart.in/feed.xml" />


<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-91043800-1', 'auto');
 ga('send', 'pageview');

</script>


</head>

  <body>
    <!--- Header and nav template site-wide -->
<header>
  <nav class="group logo-wrap">
		<a href="/" class="logo"><img class="badge" src="/assets/img/believe.jpg" alt="JDM"></a>
		<h1 class="websitetitle"><a href="/">John D. Martin III</a></h1>
	</nav>
	<nav class="bottom-group">
	
	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
		    
		      <a href="/cv/">CV</a>
		    
	    
  	
		
		    
		      <a href="/">About</a>
		    
	    
  	
		
		    
		      <a href="/research/">Research</a>
		    
	    
  	
		
		    
		      <a href="/teaching/">Teaching</a>
		    
	    
  	
		
		    
		      <a href="/blog/">Blog</a>
		    
	    
  	
		
		    
		      <a href="/contact/">Contact</a>
		    
	    
  	
	</nav>
</header>
    <article class="group">
      <a href="/computing/2017/02/05/galliumos-on-Lenovo-Chromebook/"><h1 class="contrast">GalliumOS on Chromebook</h1></a>
John D. Martin III
<br/><span class="smaller">February 5, 2017</span>  <br/>

<p><span class='newthought'>I have had a Chromebook for a few years</span>  and have always wanted to put a real Linux distribution on it. 
This weekend my friend <a href="https://twitter.com/hauspoor">Elliott Hauser</a> showed me <a href="https://galliumos.org/">GalliumOS</a>, which is being developed as a full but lightweight GNU/Linux distribution for Chromebooks. </p>

<!--more-->

<p>This desire to have real Linux on my Chromebook was recently rekindled while working with students to install <a href="https://www.kali.org/">Kali Linux</a> so that we can work on a <a href="http://gnuradio.org/">GNURadio</a> project in <a href="https://inls718.johndmart.in">class</a>. 
I wanted to install Kali on the Lenovo N20P that I have been carrying everywhere for the last 2+ years, and so I tried <a href="https://github.com/dnschneid/crouton">Crouton</a>, since it has Kali as one of the available distributions. </p>

<p>I couldn&#39;t get it to actually start the desktop environment, though. 
It would take the start command and then go to blank screen and then do nothing past that. </p>

<h1 id="chrx">CHRX</h1>

<p>I mentioned this to Elliott and he suggested using <a href="https://github.com/reynhout/chrx">CHRX</a> to set up a real dual-boot instead of Crouton, which just places another Linux chroot inside ChromeOS. 
Kali Linux was not one of the install options, but GalliumOS 
I played around with it on one of his devices and was pretty impressed. 
It had all the packages I need to run GNURadio with SDR devices, so I decided to give it a try. </p>

<p>I followed the instructions available on the <a href="https://wiki.galliumos.org/Installing">GalliumOS wiki</a> for my hardware (<a href="https://wiki.galliumos.org/Installing/Baytrail">Intel Baytrail</a>), which requires a firmware update before the install can begin. </p>

<p>I should add that the Chromebook was already in <a href="https://wiki.galliumos.org/Installing/Preparing">developer mode</a> before I began. 
The GalliumOS involved downloading and running the <a href="https://chrx.org/#usage">install script</a> once to update the firmware and install the legacy bootloader.<label for='warning' class='margin-toggle sidenote-number'></label><input type='checkbox' id='warning' class='margin-toggle'/><span class='sidenote'>It is really important to actually look at and understand the scripts that you are downloading before you run them using sudo. The method on the CHRX page uses several commands strung together which download and then run the script without pausing. It is better to download the script first and then run it, in my opinion, but everyone makes their own choices. </span> 
This powerwashes and &quot;repairs&quot; the Chromebook to repartition the SSD.
Then, after a reboot, downloading and running the same script. </p>

<p>I allocated the maximum available space to GalliumOS, because I&#39;m not going to use ChromeOS much if at all at this point. 
I&#39;ll probably eventually just remove that partition altogether. </p>

<h1 id="touchscreen">Touchscreen</h1>

<p>The touchscreen on the N20P worked out of the box with GalliumOS, but I noticed that it failed to respond after I closed and reopened the lid. </p>

<p>After some poking around, I figured out that the there was something happening with the kernel module for the touchscreen that made it fail after a lid close suspend. 
It comes back just fine after a suspend from the interface, but if the lid is closed, then the touchscreen doesn&#39;t work. </p>

<p>I was able to get it working once again once out of suspend by opening a terminal and reloading the <code>atmel_mxt_ts</code> module:</p>

<p><code>sudo rmmod atmel_mxt_ts &amp;&amp; sudo modprobe atmel_mxt_ts</code></p>

<p>To avoid having to do that myself every time. I added a script (as root) to <code>/lib/systemd/system-sleep/</code> that reloads the module after the system comes back from suspend triggered by lid closure.</p>
<div class="highlight"><pre><code class="language-" data-lang="">
<span class="c">#!/bin/bash</span>
<span class="c"># /lib/systemd/system-sleep/touchscreen</span>
<span class="c"># This will reload the atmel_mxt_ts module after suspension from lid close </span>
<span class="c"># so that the touchscreen will function.</span>

<span class="nb">set</span> -e

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"suspend"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"hybrid-sleep"</span> <span class="o">]</span>; <span class="k">then
    case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
        </span>post<span class="p">)</span> /sbin/rmmod atmel_mxt_ts <span class="o">&amp;&amp;</span> /sbin/modprobe atmel_mxt_ts <span class="p">;;</span>
    <span class="k">esac</span>
<span class="k">fi</span>

</code></pre></div>
<p>This is a hack, and there is likely a better way to do this, but it works now, so I&#39;m sated for the moment. </p>

<p>Now I can install GNURadio and play with Software Defined Radio (SDR) on my Chromebook. </p>


<p>
  <br/>
  <ul class="tags">
    <li><a href="/blog/topics#CHRX" class="tag">CHRX</a></li><li><a href="/blog/topics#GalliumOS" class="tag">GalliumOS</a></li><li><a href="/blog/topics#ChromeOS" class="tag">ChromeOS</a></li><li><a href="/blog/topics#Chromebook" class="tag">Chromebook</a></li><li><a href="/blog/topics#Lenovo+N20P" class="tag">Lenovo-N20P</a></li><li><a href="/blog/topics#atmel_mxt_ts" class="tag">atmel_mxt_ts</a></li><li><a href="/blog/topics#touchscreen" class="tag">touchscreen</a></li><li><a href="/blog/topics#Ubuntu" class="tag">Ubuntu</a></li><li><a href="/blog/topics#Linux" class="tag">Linux</a></li>
  </ul> 
</p>
    </article>
    <span class="print-footer">GalliumOS on Chromebook - February 5, 2017 - John D. Martin III</span>
    <footer>
  <div class="blognav">
    
      <a class="prev" href="/teaching/2017/02/01/teaching-soft-skills/">&laquo;&nbsp;<span class="smaller">Previous:</span>&nbsp;Teaching soft skills</a>
    
    
      <a class="next" href="/computing/2017/03/20/onion/"><span class="smaller">Next:</span>&nbsp;Onion&nbsp;&raquo;</a>
    
  </div>
  <hr class="slender">
  <ul class="footer-links">
    
    
      <li>
        <a href="//keybase.io/jdmar3" title="Verified identities at Keybase.io" target="_blank"><span class="ico-domain2"></span></a>
      </li>
    
    
      <li>
        <a href="/jdmar3.asc" title="PGP fingerprint: 67BB C847 14E0 C31A 736A  5E08 C787 DF8D D41F A8D1" ><span class="icon-key"></span></a>
      </li>
    
    
      <li>
        <a href="//twitter.com/jdmar3" title="Tweet @jdmar3" target="_blank"><span class="icon-twitter"></span></a>
      </li>
    
    
      <li>
        <a href="//github.com/jdmar3" title="Follow @jdmar3 on GitHub" target="_blank"><span class="ico-github"></span></a>
      </li>
    
    
      <li>
        <a href="//osf.io/8gx9z" title="View my work and preprints on Open Science Framework" target="_blank"><span class="ico-science"></span></a>
      </li>
    
    
      <li>
        <a href="mailto:me@johndmart.in" title="Email me@johndmart.in" target="_blank"><span class="ico-envelope"></span></a>
      </li>
    
    
      <li>
        <a href="sms:+19194428014" title="Text me at +19194428014" ><span class="icon-mobile"></span></a>
      </li>
    
    
      <li>
        <a href="http://evpoyeb3anapeyrt.onion" title="evpoyeb3anapeyrt.onion" target="_blank"><span class="icnf-tor"></span></a>
      </li>
    
    
      <li>
        <a href="/feed" title="Add RSS feed" target="_blank"><span class="icon-feed"></span></a>
      </li>
    
    
      <li>
        <a href="//cash.me/$jdmar3" title="Buy me a coffee" target="_blank"><span class="icon-coffee"></span></a>
      </li>
      
  </ul>
<div class="credits">
  <span>JOHN D. MARTIN III &nbsp;&nbsp;|&nbsp;&nbsp; Information Scientist / Digital Humanist <br/> 
  <span class="smaller">PhD student in the School of Information and Library Science at University of North Carolina at Chapel Hill. </span><br/>
  <br/>
  <a target="_blank" rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="CC-BY-NC-ND" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a><br/>

  <span class="smaller">&copy;&nbsp;<a href="/credits/">2017&nbsp;John D. Martin III</a></span>
</div>  
</footer>
  </body>
</html>
